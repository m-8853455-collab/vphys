<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Spring–Mass Energy Simulator | VPhys</title>

<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    background: #eef2f7;
  }
  header {
    background: #1e3a8a;
    color: white;
    text-align: center;
    padding: 15px;
  }
  section {
    background: white;
    margin: 15px auto;
    padding: 15px;
    width: 90%;
    border-radius: 8px;
  }
  label {
    font-weight: bold;
  }
  input, select, button {
    margin: 5px 0;
    padding: 5px;
  }
  canvas {
    border: 1px solid black;
    display: block;
    margin: 10px auto;
  }
  .energy-bar {
    height: 18px;
    background: #ddd;
    margin: 5px 0;
    position: relative;
  }
  .fill {
    height: 100%;
  }
</style>
</head>

<body>

<header>
  <h1>Spring–Mass Work–Energy Simulator</h1>
  <p>VPhys – The Virtual Physics Lab</p>
</header>

<section>
  <h2>Controls</h2>

  <label>Mass (kg):</label><br>
  <input type="number" id="mass" value="1" step="0.1"><br>

  <label>Spring Constant k (N/m):</label><br>
  <input type="number" id="k" value="10"><br>

  <label>Initial Displacement x₀ (m):</label><br>
  <input type="number" id="x0" value="0.2" step="0.05"><br>

  <label>Damping b (optional):</label><br>
  <input type="number" id="b" value="0" step="0.05"><br>

  <label>Gravity:</label><br>
  <select id="gravity">
    <option value="9.8">Earth (9.8 m/s²)</option>
    <option value="1.62">Moon (1.62 m/s²)</option>
  </select><br><br>

  <button onclick="resetSim()">Reset</button>
</section>

<section>
  <h2>Spring Animation</h2>
  <canvas id="simCanvas" width="600" height="160"></canvas>
</section>

<section>
  <h2>Energy Bars</h2>

  <label>Kinetic Energy</label>
  <div class="energy-bar"><div id="keBar" class="fill" style="background:red;"></div></div>

  <label>Potential Energy</label>
  <div class="energy-bar"><div id="peBar" class="fill" style="background:blue;"></div></div>

  <label>Total Energy</label>
  <div class="energy-bar"><div id="teBar" class="fill" style="background:green;"></div></div>
</section>

<section>
  <h2>Numerical Feedback</h2>
  <p id="numbers"></p>
  <p id="periodInfo"></p>
</section>

<section>
  <h2>Displacement vs Time</h2>
  <canvas id="graphCanvas" width="600" height="200"></canvas>
</section>

<section>
  <h2>Learning Hint</h2>
  <p>
    As the block moves, <strong>potential energy converts into kinetic energy</strong>.
    At maximum displacement, KE = 0 and PE is maximum.
    At equilibrium, KE is maximum and PE is minimum.
  </p>
</section>

<script>
let canvas = document.getElementById("simCanvas");
let ctx = canvas.getContext("2d");

let gCanvas = document.getElementById("graphCanvas");
let gctx = gCanvas.getContext("2d");

let m, k, b, g;
let x, v, a;
let t = 0;
let dt = 0.016;

let xData = [];

function resetSim() {
  m = parseFloat(document.getElementById("mass").value);
  k = parseFloat(document.getElementById("k").value);
  b = parseFloat(document.getElementById("b").value);
  g = parseFloat(document.getElementById("gravity").value);

  x = parseFloat(document.getElementById("x0").value);
  v = 0;
  t = 0;
  xData = [];
}

function update() {
  let Fs = -k * x;
  let Fd = -b * v;
  a = (Fs + Fd) / m;

  v += a * dt;
  x += v * dt;
  t += dt;

  let KE = 0.5 * m * v * v;
  let PE = 0.5 * k * x * x;
  let TE = KE + PE;

  drawSpring(x);
  drawBars(KE, PE, TE);
  drawGraph(x);

  document.getElementById("numbers").innerHTML =
    `x = ${x.toFixed(3)} m | v = ${v.toFixed(3)} m/s | KE = ${KE.toFixed(3)} J | PE = ${PE.toFixed(3)} J`;

  let T = 2 * Math.PI * Math.sqrt(m / k);
  let f = 1 / T;

  document.getElementById("periodInfo").innerHTML =
    `Period = ${T.toFixed(2)} s | Frequency = ${f.toFixed(2)} Hz`;

  requestAnimationFrame(update);
}

function drawSpring(x) {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  let base = 100;
  let scale = 300;
  let pos = base + x * scale;

  ctx.beginPath();
  ctx.moveTo(20, 80);
  ctx.lineTo(pos, 80);
  ctx.stroke();

  ctx.fillStyle = "#1e3a8a";
  ctx.fillRect(pos, 60, 40, 40);
}

function drawBars(KE, PE, TE) {
  let maxE = Math.max(KE + PE, 0.0001);

  document.getElementById("keBar").style.width = (KE / maxE * 100) + "%";
  document.getElementById("peBar").style.width = (PE / maxE * 100) + "%";
  document.getElementById("teBar").style.width = "100%";
}

function drawGraph(x) {
  xData.push(x);
  if (xData.length > 300) xData.shift();

  gctx.clearRect(0, 0, gCanvas.width, gCanvas.height);
  gctx.beginPath();

  for (let i = 0; i < xData.length; i++) {
    let px = i * 2;
    let py = 100 - xData[i] * 200;
    if (i === 0) gctx.moveTo(px, py);
    else gctx.lineTo(px, py);
  }
  gctx.stroke();
}

resetSim();
update();
</script>

</body>
</html>
